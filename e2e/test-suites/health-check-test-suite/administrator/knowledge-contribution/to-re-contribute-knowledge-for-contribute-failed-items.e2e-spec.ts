import { StepLogger } from '../../../../../core/logger/step-logger';
import { PageHelper } from '../../../../components/html/page-helper';
import { Constants } from '../../../../components/misc-utils/constants';
import { AdminHomePageHelper } from '../../../../page-objects/pages/admin-home-page/admin-home.helper';
import { AdminHomePage } from '../../../../page-objects/pages/admin-home-page/admin-home.po';
import { AdminLoginPageHelper } from '../../../../page-objects/pages/admin-login-page/admin-login.helper';
import { KnowledgeReContributionHelper } from '../../../../page-objects/pages/manage-knowledge/knowledge-contribution/knowledge-re-contribution.helper';
import { SuiteNames } from '../../../helpers/suite-names';

describe(SuiteNames.healthCheckSuite, () => {
    let loginPageHelper: AdminLoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = AdminLoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
        await loginPageHelper.goTo();
    });

    beforeEach(async () => {
        await PageHelper.switchToFirstTab();
        await loginPageHelper.goTo();
        await AdminLoginPageHelper.logout();
    });

    // Jira References - KNOV-2482
    it('To access Knowledge Re-Contributor screen. - [22409950]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:50 GMT

        StepLogger.caseId = 22409950;
        StepLogger.preCondition('Log into the application');
        await AdminLoginPageHelper.loginAsAdmin();

        StepLogger.stepId(1);
        StepLogger.step('Click on the options icon (3 lines at the top left corner).');
        await AdminHomePageHelper.clickOnBurgerIcon();
        StepLogger.verification(`The following options should be displayed.
        -Home
        -Manage workbench
        -Manage communities
        -Manage Knowledge
        -Manage People
        -Settings
        -Logout`);
        await AdminHomePageHelper.verifySideMenuDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click on Manage knowledge.');
        await AdminHomePageHelper.clickManageKnowledge();
        StepLogger.verification('List of options should be displayed.');
        await AdminHomePageHelper.verifyManageKnowledgeSubMenu();

        StepLogger.stepId(3);
        StepLogger.step('Click on Knowledge Contribution.');
        await AdminHomePageHelper.clickOnKnowledgeContributionOption();
        StepLogger.verification('Knowledge Re-Contributor option should be displayed.');
        await AdminHomePageHelper.verifyknowledgeReContributionOptionDisplayed();

        StepLogger.stepId(4);
        StepLogger.step('Click on knowledge Re-Contributor.');
        await AdminHomePageHelper.clickSubMenu(AdminHomePage.manageKnowledge.knowledgeReContribution);
        StepLogger.verification('Knowledge Re-Contributor screen should be displayed.');
        await KnowledgeReContributionHelper.verifyPageContent();
    });

    // Jira References - KNOV-2483
    it('To view the detailed list of failed items. - [22409993]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:49 GMT

        StepLogger.caseId = 22409993;
        StepLogger.preCondition('Navigate to Knowledge Recontribution page');
        await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();

        StepLogger.stepId(1);
        StepLogger.step('Go to the View List button beside Contribute failed items.');
        StepLogger.verification('View List button should be displayed.');
        await KnowledgeReContributionHelper.verifyViewListButtonDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click on the View List button.');
        await KnowledgeReContributionHelper.clickOnViewListButton();
        StepLogger.verification('Contribution Failed list window should be displayed.');
        await KnowledgeReContributionHelper.verifyContributionFailedListDialogDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on OK.');
        await KnowledgeReContributionHelper.clickOkButtonFromContributionFailedDialog();
        StepLogger.verification('Contribution Failed list window should be closed and knowledge re-contributor page should be displayed.');
        await KnowledgeReContributionHelper.verifyPageContent();
    });

    // Jira References - KNOV-2484
    it('To generate a bat file. - [22410433]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:48 GMT

        StepLogger.caseId = 22410433;
        StepLogger.preCondition('Navigate to Knowledge Recontribution page');
        await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();

        StepLogger.stepId(1);
        StepLogger.step('Click on the Contribute Failed Items check box.');
        await KnowledgeReContributionHelper.markContributeFailedItemsCheckBox();
        StepLogger.verification('Generate bat file and Start buttons should get enabled at the bottom of the page.');
        await KnowledgeReContributionHelper.verifyGenerateBatFileAndStartButtonsAreEnabled();

        StepLogger.stepId(2);
        StepLogger.step('Click on Generate bat file button.');
        await KnowledgeReContributionHelper.clickGenerateBat();
        StepLogger.verification('save bat file pop up should be displayed to enter the file name.');
        await KnowledgeReContributionHelper.verifySaveBatPopUpDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Provide a name and click on Submit.');
        await KnowledgeReContributionHelper.enterFileNameAndclickSubmit();
        StepLogger.verification('Knowledge re-contributor page should be displayed.');
        await KnowledgeReContributionHelper.verifyPageContent();
    });

    // Jira References - KNOV-2485
    it('To verify the Cancel button on the Save bat file pop up window. - [22411006]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:48 GMT

        StepLogger.caseId = 22411006;
        StepLogger.preCondition('Navigate to Knowledge Recontribution page');
        await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();

        StepLogger.stepId(1);
        StepLogger.step('Click on the Contribute Failed Items check box.');
        await KnowledgeReContributionHelper.markContributeFailedItemsCheckBox();
        StepLogger.verification('Generate bat file and Start buttons should get enabled at the bottom of the page.');
        await KnowledgeReContributionHelper.verifyGenerateBatFileAndStartButtonsAreEnabled();

        StepLogger.stepId(2);
        StepLogger.step('Click on Generate bat file button.');
        await KnowledgeReContributionHelper.clickGenerateBat();
        StepLogger.verification('Save bat file pop up should be displayed to enter the file name.');
        await KnowledgeReContributionHelper.verifySaveBatPopUpDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on Cancel.');
        await KnowledgeReContributionHelper.switchToDialogFrameAndclickCancel();
        StepLogger.verification('Save bat file pop up should be closed and bat file should not be generated.');
        await KnowledgeReContributionHelper.verifyPopClosed();
    });

    // Jira References - KNOV-2486
    it('To verify the queued tab. - [22411050]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:48 GMT

        StepLogger.caseId = 22411050;
        StepLogger.preCondition('Navigate to Knowledge Recontribution page');
        await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();

        StepLogger.stepId(1);
        StepLogger.step('Check the "Contribute Failed Items" check box.');
        await KnowledgeReContributionHelper.markContributeFailedItemsCheckBox();
        StepLogger.verification(`The check box should be checked.
        Generate Bat File and start buttons should get enabled at the bottom of the page.`);
        await KnowledgeReContributionHelper.verifyContributeFailedItemsCheckBoxIsMarked();
        await KnowledgeReContributionHelper.verifyGenerateBatFileAndStartButtonsAreEnabled();

        StepLogger.stepId(2);
        StepLogger.step('Click on Start.');
        await KnowledgeReContributionHelper.clickStart();
        StepLogger.verification('A confirmation pop should be displayed.');
        await KnowledgeReContributionHelper.verifyStartProcessConfirmationPopUpDisplayedAndClickYes();

        // Step 3 is covered in step 2
        StepLogger.stepId(3);
        StepLogger.step('Click on Yes.');
        StepLogger.verification(`Contribution Progress Monitor screen should be displayed with 3 tabs available.
        -Contribution
        -Queued tab
        -Previous Runs`);
        await KnowledgeReContributionHelper.verifyContributionProgressMonitorDisplayed();

        StepLogger.stepId(4);
        StepLogger.step('Click on the queued tab.');
        await KnowledgeReContributionHelper.clickQueuedTab();
        StepLogger.verification(`Following details should be displayed.
        -Updated
        -Status
        -Total to be queued
        -Queued`);
        await KnowledgeReContributionHelper.verifyQueuedTab();

        StepLogger.stepId(5);
        StepLogger.step('Click on OK.');
        await KnowledgeReContributionHelper.clickOk();
        StepLogger.verification('Knowledge re-contributor page should be displayed.');
        await KnowledgeReContributionHelper.verifyPageContent();
    });

    // Jira References - KNOV-2487
    it(`To verify the No button in the confirmation pop up window when starting the
    re-contribution Knowledge for Contribute Failed Items. - [22410022]`, async () => {
            // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:48 GMT

            StepLogger.caseId = 22410022;
            StepLogger.preCondition('Navigate to Knowledge Recontribution page');
            await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();

            StepLogger.stepId(1);
            StepLogger.step('Check the "Contribute Failed Items" check box.');
            await KnowledgeReContributionHelper.markContributeFailedItemsCheckBox();
            StepLogger.verification(`The check box should be checked.
        Generate Bat File and start buttons should get enabled at the bottom of the page.`);
            await KnowledgeReContributionHelper.verifyContributeFailedItemsCheckBoxIsMarked();
            await KnowledgeReContributionHelper.verifyGenerateBatFileAndStartButtonsAreEnabled();

            StepLogger.stepId(2);
            StepLogger.step('Click on Start.');
            await KnowledgeReContributionHelper.clickStart();
            StepLogger.verification('A confirmation pop should be displayed.');
            await KnowledgeReContributionHelper.verifyStartProcessConfirmationPopUpDisplayedAndClickNo();

            // Step 3 is covered in step 2
            StepLogger.stepId(3);
            StepLogger.step('Click on No.');
            StepLogger.verification(`re-contribution Knowledge for Contribute Failed Items
        should not be started and Knowledge re-contributor screen should be displayed.`);
            await KnowledgeReContributionHelper.verifyPageContent();
        });

    // Jira References - KNOV-2488
    it('To start the re-contribution Knowledge for Contribute Failed Items. - [22409967]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:49 GMT

        StepLogger.caseId = 22409967;
        StepLogger.preCondition('Navigate to Knowledge Recontribution page');
        await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();

        StepLogger.stepId(1);
        StepLogger.step('Check the "Contribute Failed Items" check box.');
        await KnowledgeReContributionHelper.markContributeFailedItemsCheckBox();
        StepLogger.verification(`The check box should be checked.
        Generate Bat File and start buttons should get enabled at the bottom of the page.`);
        await KnowledgeReContributionHelper.verifyContributeFailedItemsCheckBoxIsMarked();
        await KnowledgeReContributionHelper.verifyGenerateBatFileAndStartButtonsAreEnabled();

        StepLogger.stepId(2);
        StepLogger.step('Click on Start.');
        await KnowledgeReContributionHelper.clickStart();
        StepLogger.verification('A confirmation pop should be displayed.');
        await KnowledgeReContributionHelper.verifyStartProcessConfirmationPopUpDisplayedAndClickYes();

        // Step 3 is covered in step 2
        StepLogger.stepId(3);
        StepLogger.step('Click on Yes.');
        StepLogger.verification(`Contribution Progress Monitor screen should be displayed with 3 tabs available.
        -Contribution
        -Queued tab
        -Previous Runs`);
        await KnowledgeReContributionHelper.verifyContributionProgressMonitorDisplayed();

        StepLogger.preCondition('Close current tab and switch to the first one');
        await PageHelper.closeCurrentTab();
        await PageHelper.switchToFirstTab();
    });

    // Jira References - KNOV-2490
    it('To stop the Contribution Progress Monitor. - [22409985]', async () => {
        // Auto generated by aurea-automation - util on Tue, 30 Apr 2019 23:56:50 GMT

        StepLogger.caseId = 22409985;
        StepLogger.preCondition('Navigate to Knowledge Recontribution page');
        await KnowledgeReContributionHelper.navigateToKnowledgeReContribution();
        await KnowledgeReContributionHelper.startRecontributionForFailedItems();

        StepLogger.stepId(1);
        StepLogger.step('Click on Stop button in the Contribution Progress Monitor screen.');
        await KnowledgeReContributionHelper.switchToDialogAndClickStop();
        StepLogger.verification('A confirmation pop should be displayed.');
        await KnowledgeReContributionHelper.verifyStopCurrentBatchConfirmationPopUpDisplayedAndClickYes(
            Constants.number.one);

        // Step 2 is covered in step 1
        StepLogger.stepId(2);
        StepLogger.step('Click on Yes.');
        StepLogger.verification('Contribution Progress Monitor screen should be displayed.');
        await KnowledgeReContributionHelper.verifyContributionProgressMonitorDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on OK.');
        await KnowledgeReContributionHelper.clickOk();
        StepLogger.verification('Knowledge Re-contributor screen should be displayed.');
        await KnowledgeReContributionHelper.verifyPageContent();
    });
});
