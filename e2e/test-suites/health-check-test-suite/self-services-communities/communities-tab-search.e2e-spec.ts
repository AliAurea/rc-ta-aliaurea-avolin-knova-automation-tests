import { StepLogger } from '../../../../core/logger/step-logger';
import { PageHelper } from '../../../components/html/page-helper';
import { CommunitiesConstant } from '../../../page-objects/pages/self-service/communities.constant';
import { CommunitiesPageHelper } from '../../../page-objects/pages/self-service/communities.helper';
import { CommunitiesPage } from '../../../page-objects/pages/self-service/communities.po';
import { SelfServiceHomePageHelper } from '../../../page-objects/pages/self-service/self-service-home-page.helper';
import { SelfServiceLoginPageHelper } from '../../../page-objects/pages/self-service/self-service-login.helper';
import { SuiteNames } from '../../helpers/suite-names';

describe(SuiteNames.healthCheckSuite, () => {
    let loginPageHelper: SelfServiceLoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = SelfServiceLoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
        await loginPageHelper.goTo();
    });

    beforeEach(async () => {
        await PageHelper.switchToFirstTab();
        await SelfServiceLoginPageHelper.logout();
        await SelfServiceLoginPageHelper.loginAsAdmin();
    });

    // Jira References - KNOV-529
    it('Verify the communities page when communities tab is selected. - [22893794]', async () => {
        // Auto generated by aurea-automation - util on Thu, 07 Mar 2019 16:21:35 GMT
        StepLogger.caseId = 22893794;

        // Step 1 is covered in the beforeAll block
        StepLogger.stepId(1);
        StepLogger.step('Hit the url of the application.');
        StepLogger.verification('Login page is displayed of the application.');

        StepLogger.stepId(2);
        StepLogger.step('Log in to the application.');
        StepLogger.verification('The user is logged in successfully.');
        await SelfServiceHomePageHelper.verifyWelcomeLabelDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on communities tab.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();
        StepLogger.verification('Communities page is displayed.');
        await CommunitiesPageHelper.verifyCommunitiesHomeDisplayed();
    });

    // Jira References - KNOV-529
    it('Verify that Show All works fine for My Most Recent Posts Section. - [22893796]', async () => {
        // Auto generated by aurea-automation - util on Thu, 07 Mar 2019 16:35:18 GMT
        StepLogger.caseId = 22893796;

        StepLogger.preCondition('Run the TC C22893794.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Verify "Show All" is displayed next to My most recent posts section.');
        StepLogger.verification('Show All hyperlink is displayed.');
        await CommunitiesPage.formControls.showAllLink.verifyDisplayedStatus();

        StepLogger.stepId(2);
        StepLogger.step('Click on show All.');
        StepLogger.verification('All the entries are displayed on page.');
        await CommunitiesPageHelper.clickShowAllAndVerifyEntries();

        StepLogger.stepId(3);
        StepLogger.step('Click on show fewer.');
        StepLogger.verification('Some entries are hidden now.');
        await CommunitiesPageHelper.clickShowFewerAndVerifyEntries();
    });

    // Jira References - KNOV-529
    it('Verify that edit available in My Subscriptions Section navigates to content Subscriptions page of user profile. - [22893797]', async () => {
        // Auto generated by aurea-automation - util on Thu, 07 Mar 2019 18:02:50 GMT
        StepLogger.caseId = 22893797;

        StepLogger.preCondition('Run the TC C22893794.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Click on Edit button in My Subscriptions section.');
        StepLogger.verification('Content Subscriptions is displayed.');
        await CommunitiesPageHelper.clickEditAndVerifyMySubscriptions();

        StepLogger.stepId(2);
        StepLogger.step('Click on Edit button for document , community , thread type etc.');
        StepLogger.verification('Edit subscription is displayed for the selected subscription.');
        await CommunitiesPageHelper.clickEditOneSubscriptionAndVerifyEditDialog();

        StepLogger.stepId(3);
        StepLogger.step('Click on cancel button.');
        await CommunitiesPageHelper.clickOnCancel();
        StepLogger.verification('The window is closed.');
        await CommunitiesPageHelper.verifyMySubscriptionsWindowIsClosed();
    });

    // Jira References - KNOV-529
    it('Verify that Guided Search are preserved when you switch to Advanced Search. - [22893799]', async () => {
        // Auto generated by aurea-automation - util on Thu, 07 Mar 2019 19:05:53 GMT
        const defSearch = CommunitiesConstant.testData.generalSearch;
        StepLogger.caseId = 22893799;

        StepLogger.preCondition('Run the TC C22893794.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Select any value from drop down list of search field.');
        StepLogger.verification('the page shows the value selected.');
        await CommunitiesPageHelper.selectAndValidateSearchSelected(defSearch);

        StepLogger.stepId(2);
        StepLogger.step('Click on search button.');
        StepLogger.verification('The page gets refreshes.');
        await CommunitiesPageHelper.clickSearchAndVerifyRefresh();

        StepLogger.stepId(3);
        StepLogger.step('Click on advanced search.');
        StepLogger.verification('Additional filters are displayed.');
        await CommunitiesPageHelper.clickAdvancedSearchAndVerifyFiltersDisplayed();

        StepLogger.stepId(4);
        StepLogger.step('Again click on guided search.');
        StepLogger.verification('The Guided Search are preserved.');
        await CommunitiesPageHelper.clickOnGuidedSearchAndVerifyPreserved();
    });

    // Jira References - KNOV-529
    it('Verify the user is able to access the filters for Newest Discussions and Most Popular Discussion Sections. - [22893823]', async () => {
        // Auto generated by aurea-automation - util on Thu, 07 Mar 2019 20:54:40 GMT
        const defSearch = CommunitiesConstant.testData.communitySearch;
        const defValue = CommunitiesConstant.testData.defSearchVal;
        StepLogger.caseId = 22893823;

        StepLogger.preCondition('Run the TC C22893794.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Click on the newest discussions show filter.');
        StepLogger.verification('It will display all drop down values.');
        await CommunitiesPageHelper.clickNewestDiscussionsAndVerifyDropDownValues();

        StepLogger.stepId(2);
        StepLogger.step('Select any value from the drop down list.');
        StepLogger.verification('The results refreshed as per the selection made.');
        await CommunitiesPageHelper.selectAndValidateNewestDiscussion(defSearch);

        StepLogger.stepId(3);
        StepLogger.step('Click on the Most popular discussions show filter.');
        StepLogger.verification('It will display all drop down values.');
        await CommunitiesPageHelper.clickMostPopularDiscussionsAndVerifyDropDownValues();

        StepLogger.stepId(4);
        StepLogger.step('Select any value from the drop down list.');
        StepLogger.verification('The results refreshed as per the selection made.');
        await CommunitiesPageHelper.selectAndValidateMostPopularDiscussion(defValue);
    });

    // Jira References - KNOV-529
    it('Verify the user can select additional filters as required. - [22893801]', async () => {
        // Auto generated by aurea-automation - util on Fri, 08 Mar 2019 16:03:48 GMT
        StepLogger.caseId = 22893801;

        StepLogger.preCondition('Run the TC C22893794.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Click on Advanced Search .');
        StepLogger.verification('New fields are displayed on screen for advanced search.');
        await CommunitiesPageHelper.clickAdvancedSearchAndVerifyFiltersDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Select any value from the drop down list in Search In field.');
        StepLogger.verification('user is able to select the value in search in field.');
        await CommunitiesPageHelper.selectAndVerifySearchInField();

        StepLogger.stepId(3);
        StepLogger.step('Select value for community.');
        StepLogger.verification('User is able to select the value in community field.');
        await CommunitiesPageHelper.selectAndVerifyCommunitiesField();

        StepLogger.stepId(4);
        StepLogger.step('Click on search button.');
        StepLogger.verification('The results are displayed on page as per the entered criteria.');
        await CommunitiesPageHelper.clickSearchAndVerifyRefresh(true);
    });

    // Jira References - KNOV-529
    it('Verify the user can save a search by clicking on save search. - [22893807]', async () => {
        // Auto generated by aurea-automation - util on Fri, 08 Mar 2019 16:05:00 GMT
        const searchName = CommunitiesConstant.testData.defSearchName;
        StepLogger.caseId = 22893807;

        StepLogger.preCondition('Run the TC C22893794.');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Click on advanced search and fill in the fields.');
        await CommunitiesPageHelper.clickAdvancedSearchAndVerifyFiltersDisplayed();
        StepLogger.verification('user is able to enter the fields.');
        await CommunitiesPageHelper.enterAndValidateAdvancedSearchFields();

        StepLogger.stepId(2);
        StepLogger.step('Click on search button.');
        StepLogger.verification('Results are displayed on page for the entered fields.');
        await CommunitiesPageHelper.clickSearchAndVerifyRefresh(true);

        StepLogger.stepId(3);
        StepLogger.step('Click on save search .');
        StepLogger.verification('Add search to favorites window is displayed.');
        await CommunitiesPageHelper.clickOnSaveSearchAndVerifySearchWindow();

        StepLogger.stepId(4);
        StepLogger.step('Enter a name .');
        StepLogger.verification('user enters the name and is able to save the search.');
        await CommunitiesPageHelper.enterAndSaveSearchName(searchName);

        StepLogger.stepId(5);
        StepLogger.step('Click on "X".');
        StepLogger.verification('the window closes.');
        await CommunitiesPageHelper.closeWindowAndVerify();
    });
});
