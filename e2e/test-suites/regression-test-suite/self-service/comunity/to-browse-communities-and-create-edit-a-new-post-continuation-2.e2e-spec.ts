import { StepLogger } from '../../../../../core/logger/step-logger';
import { PageHelper } from '../../../../components/html/page-helper';
import { Constants } from '../../../../components/misc-utils/constants';
import { CommunitiesPageHelper } from '../../../../page-objects/pages/self-service/communities.helper';
import { SelfServiceHomePageHelper } from '../../../../page-objects/pages/self-service/self-service-home-page.helper';
import { SelfServiceLoginPageHelper } from '../../../../page-objects/pages/self-service/self-service-login.helper';
import { SuiteNames } from '../../../helpers/suite-names';

describe(SuiteNames.regressionSuite, () => {
    let loginPageHelper: SelfServiceLoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = SelfServiceLoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
        await loginPageHelper.goTo();
    });

    beforeEach(async () => {
        await PageHelper.switchToFirstTab();
        await SelfServiceLoginPageHelper.logout();
        await SelfServiceLoginPageHelper.loginAsAdmin();
    });

    // Jira References - KNOV-1956
    it('Verify the Community field dropdown displays the Communities available in the "Post a Question" page - [22938357]', async () => {
        // Auto generated by aurea-automation - util on Sat, 23 Mar 2019 17:57:23 GMT

        StepLogger.caseId = 22938357;
        StepLogger.preCondition('Click on Communities tab');
        await CommunitiesPageHelper.clickOnCommunitiesTab();

        StepLogger.stepId(1);
        StepLogger.step('Click on "New Post" button as specified in the Pre-condition [C22938328]');
        await CommunitiesPageHelper.clickOnNewPostButton();
        StepLogger.verification('User should get navigated to the "Post a Question" page');
        await CommunitiesPageHelper.verifyPostAQuestionPageDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Select the Community field drop down and verify it displays the available Communities');
        await CommunitiesPageHelper.selectCommunityDropdownOptionByIndex(Constants.number.two);
        await CommunitiesPageHelper.clickOnComunityDropdown();
        StepLogger.verification('Community field drop down should display the available Communities');
        await CommunitiesPageHelper.verifyComunityDropdownOptionsDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Click on "Cancel" button in "Post a Question" page');
        await CommunitiesPageHelper.clickOnCancelButton();
        StepLogger.verification('User should get navigated back to the Communities Home page');
        await CommunitiesPageHelper.verifyCommunitiesHomeDisplayed();
    });

    // Jira References - KNOV-1957
    it('Verify Admin user is able to navigate to the Communities tab and view communities in Knova Self Service Portal - [22937679]', async () => {
        // Auto generated by aurea-automation - util on Sat, 23 Mar 2019 17:57:23 GMT

        StepLogger.caseId = 22937679;

        // Step 1 is covered in beforeEach
        StepLogger.stepId(1);
        StepLogger.step('Launch the Knova Self Service Portal with Admin Credentials as specified in the pre-condition  [C22937176]');
        StepLogger.verification('Admin User should be able to login to the Knova Self Service Portal successfully');
        await SelfServiceHomePageHelper.verifyWelcomeLabelDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click on "Communities" tab');
        await CommunitiesPageHelper.clickOnCommunitiesTab();
        StepLogger.verification('User should get navigated to the Communities tab without errors');
        await CommunitiesPageHelper.verifyCommunitiesHomeDisplayed();

        StepLogger.stepId(3);
        StepLogger.step('Verify the Communities tab displays all the Communities currently available in the  Knova Self Service Portal');
        StepLogger.verification('Communities tab should display all the Communities currently available in the  Knova Self Service Portal');
        await CommunitiesPageHelper.verifyCommnityLinksDisplayed();
    });

    // Jira References - KNOV-1958
    it(`Verify click on "Communities Home" in the thread bar of the selected Community page
    navigates user back to the Communities Home page - [22938265]`, async () => {
            // Auto generated by aurea-automation - util on Sat, 23 Mar 2019 17:57:23 GMT

            StepLogger.caseId = 22938265;

            // Step 1 is covered in beforeEach
            StepLogger.stepId(1);
            StepLogger.step('Launch the Knova Self Service Portal with Admin Credentials as specified in the pre-condition [C22937176]');
            StepLogger.verification('Admin User should be able to login to the Knova Self Service Portal successfully');
            await SelfServiceHomePageHelper.verifyWelcomeLabelDisplayed();

            StepLogger.stepId(2);
            StepLogger.step('Click on "Communities" tab');
            await CommunitiesPageHelper.clickOnCommunitiesTab();
            StepLogger.verification('User should get navigated to the Communities tab without errors');
            await CommunitiesPageHelper.verifyCommunitiesHomeDisplayed();

            StepLogger.stepId(3);
            StepLogger.step('Select a Community and click on its hyperlink in the "Browse Communities" section');
            const community = await CommunitiesPageHelper.clickOnRandomComunityLink();
            StepLogger.verification('User should get navigated to the selected Community page successfully');
            await CommunitiesPageHelper.verifyCommnityLinkDetailsDisplayed(community);

            StepLogger.stepId(4);
            StepLogger.step('Click on "Communities Home" hyperlink in the thread bar of Selected Community page');
            await CommunitiesPageHelper.clickOnCommunitiesHomeLink();
            StepLogger.verification('User should get navigated to the Communities Home page successfully without errors');
            await CommunitiesPageHelper.verifyCommunitiesHomeDisplayed();
        });
});
