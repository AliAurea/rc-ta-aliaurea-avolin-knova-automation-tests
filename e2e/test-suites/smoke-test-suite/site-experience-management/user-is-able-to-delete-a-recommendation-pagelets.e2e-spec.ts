import { StepLogger } from '../../../../core/logger/step-logger';
import { PageHelper } from '../../../components/html/page-helper';
import { ExpectationHelper } from '../../../components/misc-utils/expectation-helper';
import { AdminHomePageHelper } from '../../../page-objects/pages/admin-home-page/admin-home.helper';
import { AdminLoginPageHelper } from '../../../page-objects/pages/admin-login-page/admin-login.helper';
import { AgentMicrositeHelper } from '../../../page-objects/pages/manage-site-experience/agent-microsite/agent-microsite.helper';
import { SuiteNames } from '../../helpers/suite-names';

describe(SuiteNames.smokeSuite, () => {
    let loginPageHelper: AdminLoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = AdminLoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
        await loginPageHelper.goTo();
    });

    beforeEach(async () => {
        await AdminLoginPageHelper.logout(true);
        await PageHelper.switchToFirstTab();
        await loginPageHelper.goTo();
        await AdminLoginPageHelper.loginAsAdmin();
    });

    // Jira References - KNOV-2529
    it(`Validation of the admin user accessing the "Pagelets" tab of "Recommendation Manager
    for <microsite>" page in Knova Administrator application and see if the option to
    delete is available - [22437187]`, async () => {
            // Auto generated by aurea-automation - util on Thu, 02 May 2019 16:15:41 GMT

            StepLogger.caseId = 22437187;
            StepLogger.stepId(1);
            StepLogger.step('Click the burger icon from the top left corner of the page.');
            await AdminHomePageHelper.clickOnBurgerIcon();
            StepLogger.verification('The vertical menu bar with the available modules and options should be displayed on the left end of the page.');
            await AdminHomePageHelper.verifySideMenuDisplayed();

            StepLogger.stepId(2);
            StepLogger.step('Scroll down the menu bar and click the "Manage Site Experience" module.');
            await AdminHomePageHelper.clickOnManageSiteExperienceMenu();
            StepLogger.verification(`The list of options available options in the
            "Manage Site Experience" should be displayed on the right side of the menu bar.`);
            await AdminHomePageHelper.verifyManageSiteExpSubMenu();

            StepLogger.stepId(3);
            StepLogger.step('Click on any of the microsite name displayed. (e.g, Customer Microsite)');
            await AdminHomePageHelper.clickOnAgentMicrositeOption();
            StepLogger.verification('The list of options available for the selected microsite name should be displayed just under the selected microsite.');
            await AdminHomePageHelper.verifyAgentMicrositeMenuOptions();

            StepLogger.stepId(4);
            StepLogger.step('Click the "Recommendation Manager" option from the list displayed.');
            await AdminHomePageHelper.clickOnRecomendationManagerOption();
            StepLogger.verification(`User should be navigated to the "Recommendation Manager for
            <microsite>" page with the list of available pagelets for the selected microsite
            displayed in "Pagelets" tab.`);
            await AgentMicrositeHelper.verifyRecomendationManagerPageDisplayed();

            StepLogger.stepId(5);
            StepLogger.step('Against each of the available pagelet, verify if the "X" button is available in the "Delete" column.');
            StepLogger.verification('The "X" button should be available in the "Delete" column for each of the available pagelet record.');
            await AgentMicrositeHelper.verifyDeleteIconDisplayedIPageletsPage();

            StepLogger.stepId(6);
            StepLogger.step('Click the burger icon from the top left corner of the page and select the "Logout" option.');
            await AdminLoginPageHelper.logout(true);
            StepLogger.verification('user should be logged out and the Knova Administrator application login page should be displayed.');
            await AdminLoginPageHelper.verifyUserNotLogged();
        });

    // Jira References - KNOV-2530
    it(`Validation of the admin user discarding the deletion process using the "Cancel"
    button in the "Message from webpage" message box when attempting to delete the
    pagelet - [22437219`, async () => {
            // Auto generated by aurea-automation - util on Thu, 02 May 2019 16:15:41 GMT

            StepLogger.caseId = 22437219;
            StepLogger.preCondition('Navigate to Recommendation page');
            await AdminHomePageHelper.navigateToRecommendationPage();

            StepLogger.stepId(1);
            StepLogger.step('For a pagelet record, click the  "X" button available in the "Delete" field.');
            const pagelet = await AgentMicrositeHelper.clickOnFirstDeleteIconFromPageletsPage();
            StepLogger.verification(`The "Message from webpage" message box should be displayed with
            the message as "Are you sure to delete <ID of the selected record> pagelet ?" along
            with the OK and Cancel button.`);
            await AgentMicrositeHelper.verifyDeletePageleteConfirmationMessageDisplayedAndClickCancel();

            // Step 2 is covered in step 1
            StepLogger.stepId(2);
            StepLogger.step('Click the "Cancel" button.');
            StepLogger.verification('The message box should be closed and the selected pagelet record should not be removed from the "Pagelets" page.');
            await ExpectationHelper.verifyAlertIsNotPresent();
            await AgentMicrositeHelper.verifyCreatedPageletDisplayed(pagelet);

            StepLogger.stepId(3);
            StepLogger.step('Click the burger icon from the top left corner of the page and select the "Logout" option.');
            await AdminLoginPageHelper.logout(true);
            StepLogger.verification('user should be logged out and the Knova Administrator application login page should be displayed.');
            await AdminLoginPageHelper.verifyUserNotLogged();
        });

    // Jira References - KNOV-2531
    it(`Validation of the admin user deleting an existing pagelet with location as "Homepage"
    from the "Recommendation Manager for <microsite>" page in Knova Administrator
    application - [22437198]`, async () => {
            // Auto generated by aurea-automation - util on Thu, 02 May 2019 16:15:41 GMT

            StepLogger.caseId = 22437198;
            StepLogger.preCondition('Navigate to Recommendation page');
            await AdminHomePageHelper.navigateToRecommendationPage();
            const pagelet = await AgentMicrositeHelper.editTheFirstPageleteToSelectShowOnHomePage();

            StepLogger.stepId(1);
            StepLogger.step(`For a pagelet record with home symbol alone available in the
            "Location" field, click the  "X" button available in the "Delete" field.`);
            await AgentMicrositeHelper.clickOnFirstDeleteIconFromPageletsPage();
            StepLogger.verification(`The "Message from webpage" message box should be displayed with
            the message as "Are you sure to delete <ID of the selected record> pagelet ?"
            along with the OK and Cancel button.`);
            await AgentMicrositeHelper.verifyDeletePageleteConfirmationMessageDisplayedAndClickOk();

            // Step 2 is covered in step 1
            StepLogger.stepId(2);
            StepLogger.step('Click the OK button.');
            StepLogger.verification('The message box should be closed and the selected pagelet record should be removed from the "Pagelets" page.');
            await ExpectationHelper.verifyAlertIsNotPresent();
            await AgentMicrositeHelper.verifyPageletNotDisplayed(pagelet);

            StepLogger.stepId(3);
            StepLogger.step('Click the burger icon from the top left corner of the page and select the "Logout" option.');
            await AdminLoginPageHelper.logout(true);
            StepLogger.verification('user should be logged out and the Knova Administrator application login page should be displayed.');
            await AdminLoginPageHelper.verifyUserNotLogged();
        });

    // Jira References - KNOV-2532
    it(`Validation of the admin user deleting an existing pagelet with location as
    "Search and Home Page" from the "Recommendation Manager for <microsite>"
    page in Knova Administrator application - [22437213]`, async () => {
            // Auto generated by aurea-automation - util on Thu, 02 May 2019 16:15:41 GMT

            StepLogger.caseId = 22437213;
            StepLogger.preCondition('Navigate to Recommendation page');
            await AdminHomePageHelper.navigateToRecommendationPage();
            const pagelet = await AgentMicrositeHelper.editTheFirstPageleteToSelectShowOnSearchAndHomePage();

            StepLogger.stepId(1);
            StepLogger.step(`For a pagelet record with home and magnifier symbol available in the
            "Location" field, click the  "X" button available in the "Delete" field.`);
            await AgentMicrositeHelper.clickOnFirstDeleteIconFromPageletsPage();
            StepLogger.verification(`The "Message from webpage" message box should be displayed with
            the message as "Are you sure to delete <ID of the selected record> Pagelet ?" along
            with the OK and Cancel button.`);
            await AgentMicrositeHelper.verifyDeletePageleteConfirmationMessageDisplayedAndClickOk();

            // Step 2 is covered in step 1
            StepLogger.stepId(2);
            StepLogger.step('Click the OK button.');
            StepLogger.verification('The message box should be closed and the selected pagelet record should be removed from the "Pagelets" page.');
            await ExpectationHelper.verifyAlertIsNotPresent();
            await AgentMicrositeHelper.verifyPageletNotDisplayed(pagelet);

            StepLogger.stepId(3);
            StepLogger.step('Click the burger icon from the top left corner of the page and select the "Logout" option.');
            await AdminLoginPageHelper.logout(true);
            StepLogger.verification('user should be logged out and the Knova Administrator application login page should be displayed.');
            await AdminLoginPageHelper.verifyUserNotLogged();
        });

    // Jira References - KNOV-2533
    it(`Validation of the admin user deleting an existing pagelet with location as
    "Search Page" from the "Recommendation Manager for <microsite>" page in Knova
    Administrator application - [22437209]`, async () => {
            // Auto generated by aurea-automation - util on Thu, 02 May 2019 16:15:41 GMT

            StepLogger.caseId = 22437209;
            StepLogger.preCondition('Navigate to Recommendation page');
            await AdminHomePageHelper.navigateToRecommendationPage();
            const pagelet = await AgentMicrositeHelper.editTheFirstPageleteToSelectShowOnSearchPage();

            StepLogger.stepId(1);
            StepLogger.step(`For a pagelet record with magnifier symbol alone available in the
            "Location" field, click the  "X" button available in the "Delete" field.`);
            await AgentMicrositeHelper.clickOnFirstDeleteIconFromPageletsPage();
            StepLogger.verification(`The "Message from webpage" message box should be displayed with
            the message as "Are you sure to delete <ID of the selected record> Pagelet ?" along with
            the OK and Cancel button.`);
            await AgentMicrositeHelper.verifyDeletePageleteConfirmationMessageDisplayedAndClickOk();

            // Step 2 is covered in step 1
            StepLogger.stepId(2);
            StepLogger.step('Click the OK button.');
            StepLogger.verification('The message box should be closed and the selected pagelet record should be removed from the "Pagelets" page.');
            await ExpectationHelper.verifyAlertIsNotPresent();
            await AgentMicrositeHelper.verifyPageletNotDisplayed(pagelet);

            StepLogger.stepId(3);
            StepLogger.step('Click the burger icon from the top left corner of the page and select the "Logout" option.');
            await AdminLoginPageHelper.logout(true);
            StepLogger.verification('user should be logged out and the Knova Administrator application login page should be displayed.');
            await AdminLoginPageHelper.verifyUserNotLogged();
        });
});
