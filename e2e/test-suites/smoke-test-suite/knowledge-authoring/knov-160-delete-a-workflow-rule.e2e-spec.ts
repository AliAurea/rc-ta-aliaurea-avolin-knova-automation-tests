import { StepLogger } from '../../../../core/logger/step-logger';
import { PageHelper } from '../../../components/html/page-helper';
import { AdminHomePageHelper } from '../../../page-objects/pages/admin-home-page/admin-home.helper';
import { AdminHomePage } from '../../../page-objects/pages/admin-home-page/admin-home.po';
import { AdminLoginPageHelper } from '../../../page-objects/pages/admin-login-page/admin-login.helper';
import { WorkflowBuilderHelper } from '../../../page-objects/pages/manage-knowledge/knowledge-authoring/workflow-buider.helper';
import { WorkflowBuilderConstant } from '../../../page-objects/pages/manage-knowledge/knowledge-authoring/workflow-builder.constants';
import { SuiteNames } from '../../helpers/suite-names';

describe(SuiteNames.smokeSuite, () => {
    let loginPageHelper: AdminLoginPageHelper;

    beforeAll(async () => {
        loginPageHelper = AdminLoginPageHelper.getInstance();
        await PageHelper.maximiseBrowser();
        await loginPageHelper.goTo();
    });

    beforeEach(async () => {
        await PageHelper.switchToFirstTab();
        await loginPageHelper.goTo();
        await AdminLoginPageHelper.logout(true);
        await AdminLoginPageHelper.loginAsAdmin();
    });

    // Jira References - KNOV-1488
    it('Verify Workflow Builder menu option is available - [22341864]', async () => {
        // Auto generated by aurea-automation - util on Wed, 06 Mar 2019 12:48:18 GMT
        StepLogger.caseId = 22341864;

        StepLogger.stepId(1);
        StepLogger.step('Click on the Menu icon.');
        await AdminHomePageHelper.clickOnBurgerIcon();
        StepLogger.verification('The menu list should be opened.');
        await AdminHomePageHelper.verifySidebarFieldsDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click on Manage Knowledge.');
        await AdminHomePageHelper.clickOnManageKnowledgeMenu();
        StepLogger.verification('The sub menu list should be opened.');
        await AdminHomePageHelper.verifyManageKnowledgeSubMenu();

        StepLogger.stepId(3);
        StepLogger.step('Click on Knowledge Authoring.');
        await AdminHomePageHelper.clickOnKnowledgeAuthoring();
        StepLogger.verification('The sub  menu list should be displayed.');
        await AdminHomePageHelper.verifyKnowledgeAuthoringSubmenuOptions();

        // Step 4 has been covered in step 3
        StepLogger.stepId(4);
        StepLogger.step('Verify that the option WorkFlow Builder should be available.');
        StepLogger.verification('The option Workflow Builder should be available.');
    });

    // Jira References - KNOV-1489
    it('Verify Open Workflow Builder page - [22341865]', async () => {
        // Auto generated by aurea-automation - util on Wed, 06 Mar 2019 12:48:18 GMT
        StepLogger.caseId = 22341865;

        StepLogger.stepId(1);
        StepLogger.step('Click on the Menu icon.');
        await AdminHomePageHelper.clickOnBurgerIcon();
        StepLogger.verification('The menu list should be opened.');
        await AdminHomePageHelper.verifySidebarFieldsDisplayed();

        StepLogger.stepId(2);
        StepLogger.step('Click on Manage Knowledge-->Knowledge Authoring.');
        await WorkflowBuilderHelper.goToKnowledgeAuthoring();
        StepLogger.verification('The sub menu list should be displayed.');
        await AdminHomePageHelper.verifyKnowledgeAuthoringSubmenuOptions();

        StepLogger.stepId(3);
        StepLogger.step('Click on Workflow Builder');
        await AdminHomePageHelper.clickSubMenu(AdminHomePage.knowledgeAuthoring.workflowBuilder);
        StepLogger.verification('Authoring Workflow Builder page should be opened.');
        await WorkflowBuilderHelper.verifyPageTitle();
    });

    // Jira References - KNOV-1490
    it('Verify that the Delete button is available for every rule created. - [22341878]', async () => {
        // Auto generated by aurea-automation - util on Wed, 06 Mar 2019 12:48:18 GMT
        StepLogger.caseId = 22341878;

        StepLogger.stepId(1);
        StepLogger.step('Click on the Menu icon-->Manage Knowledge-->Knowledge Authoring-->Workflow Builder');
        await WorkflowBuilderHelper.navigateToWorkflowBuilder();
        StepLogger.verification('Authoring Workflow Builder page should be opened.');
        await WorkflowBuilderHelper.verifyPageTitle();

        StepLogger.stepId(2);
        StepLogger.step('Click on the Workflow State which has at least one rule created.');
        StepLogger.verification('The State information and the available rules should be displayed.');
        await WorkflowBuilderHelper.verifySelectedWorkflowState(WorkflowBuilderConstant.workflowStates.suggestion, true);

        StepLogger.stepId(3);
        StepLogger.step('Verify that each created rule should have a Delete button for it.');
        StepLogger.verification('Each created rule should have a delete button for it.');
        await WorkflowBuilderHelper.verifyDeleteButton();
    });

    // Jira References - KNOV-1491
    it('Verify click on the Delete button is available for a rule created. - [22344198]', async () => {
        // Auto generated by aurea-automation - util on Wed, 06 Mar 2019 12:48:18 GMT
        StepLogger.caseId = 22344198;
        const ruleName = `${WorkflowBuilderConstant.labels.test}${PageHelper.getUniqueId()}`;

        StepLogger.preCondition('Create new rule');
        await WorkflowBuilderHelper.createNewRule(ruleName);

        // Step 1 has been covered in preCondition
        StepLogger.stepId(1);
        StepLogger.step('Click on the Menu icon-->Manage Knowledge-->Knowledge Authoring-->Workflow Builder');
        StepLogger.verification('Authoring Workflow Builder page should be opened.');

        // Step 2 has been covered in preCondition
        StepLogger.stepId(2);
        StepLogger.step('Click on the Workflow State which has at least one rule created.');
        StepLogger.verification('The State information and the available rules should be displayed.');

        StepLogger.stepId(3);
        StepLogger.step('Click on Delete button for any rule.');
        await WorkflowBuilderHelper.clickDeleteButton();
        StepLogger.verification('A confirmation pop-up should be displayed.');
        await WorkflowBuilderHelper.verifyDeleteAlert();

        StepLogger.postCondition('Delete rule and logout');
        await WorkflowBuilderHelper.deleteRuleAndLogout();
    });

    // Jira References - KNOV-1492
    it('Verify Cancel Delete for rule - [22344205]', async () => {
        // Auto generated by aurea-automation - util on Wed, 06 Mar 2019 12:48:18 GMT
        StepLogger.caseId = 22344205;
        const ruleName = `${WorkflowBuilderConstant.labels.test}${PageHelper.getUniqueId()}`;

        StepLogger.preCondition('Create new rule');
        await WorkflowBuilderHelper.createNewRule(ruleName);

        // Step 1 has been covered in preCondition
        StepLogger.stepId(1);
        StepLogger.step('Click on the Menu icon-->Manage Knowledge-->Knowledge Authoring-->Workflow Builder');
        StepLogger.verification('Authoring Workflow Builder page should be opened.');

        // Step 2 has been covered in preCondition
        StepLogger.stepId(2);
        StepLogger.step('Click on the Workflow State which has atleast one rule created.');
        StepLogger.verification('The State information and the available rules should be displayed.');

        StepLogger.stepId(3);
        StepLogger.step('Click on Delete button for any rule.');
        await WorkflowBuilderHelper.clickDeleteButton();
        StepLogger.verification('A confirmation pop-up should be displayed.');
        await WorkflowBuilderHelper.verifyDeleteAlert();

        StepLogger.stepId(4);
        StepLogger.step('Click Cancel.');
        await WorkflowBuilderHelper.dismissDeleteAlert();
        StepLogger.verification('The pop-up should be dismissed.');
        await WorkflowBuilderHelper.verifyDeleteAlertNotPresent();

        StepLogger.stepId(5);
        StepLogger.step('Verify the Rules list.');
        StepLogger.verification('The rule should not be deleted.');
        await WorkflowBuilderHelper.verifyCreatedRule(ruleName);

        StepLogger.postCondition('Delete rule and logout');
        await WorkflowBuilderHelper.deleteRuleAndLogout();
    });

    // Jira References - KNOV-1493
    it('Verify Delete rule - [22344207]', async () => {
        // Auto generated by aurea-automation - util on Wed, 06 Mar 2019 12:48:18 GMT
        StepLogger.caseId = 22344207;
        const ruleName = `${WorkflowBuilderConstant.labels.test}${PageHelper.getUniqueId()}`;

        StepLogger.preCondition('Create new rule');
        await WorkflowBuilderHelper.createNewRule(ruleName);

        // Step 1 has been covered in preCondition
        StepLogger.stepId(1);
        StepLogger.step('Click on the Menu icon-->Manage Knowledge-->Knowledge Authoring-->Workflow Builder');
        StepLogger.verification('Authoring Workflow Builder page should be opened.');

        // Step 2 has been covered in preCondition
        StepLogger.stepId(2);
        StepLogger.step('Click on the Workflow State which has atleast one rule created.');
        StepLogger.verification('The State information and the available rules should be displayed.');

        StepLogger.stepId(3);
        StepLogger.step('Click on Delete button for any rule.');
        await WorkflowBuilderHelper.clickDeleteButton();
        StepLogger.verification('A confirmation pop-up should be displayed.');
        await WorkflowBuilderHelper.verifyDeleteAlert();

        StepLogger.stepId(4);
        StepLogger.step('Click ok.');
        await WorkflowBuilderHelper.clickOkDeleteAlert();
        StepLogger.verification('The pop-up should be dismissed.');
        await WorkflowBuilderHelper.verifyDeleteAlertNotPresent();

        StepLogger.stepId(5);
        StepLogger.step('Verify the Rules list.');
        StepLogger.verification('The rule should be deleted.');
        await WorkflowBuilderHelper.verifyDeletedRule(ruleName);

        StepLogger.postCondition('Logout');
        await AdminLoginPageHelper.logout(true);
    });
});
